# TOEIC申込み用 漢字氏名・ローマ字整合性チェッカー

## 概要

TOEIC申込み時に、漢字氏名とローマ字氏名の整合性・正確性を検証するAWS Lambda関数。

## 目的

- 漢字氏名から推定される読みと、入力されたローマ字が整合しているかチェック
- ヘボン式ローマ字の正確性を検証
- 複数の読み候補がある場合は許容する（厳密すぎない判定）

## API仕様

### 入力

```json
{
  "kanji_sei": "山田",
  "kanji_mei": "太郎",
  "romaji_sei": "YAMADA",
  "romaji_mei": "TARO"
}
```

### 出力

```json
{
  "is_valid": true,
  "sei_check": {
    "status": "OK",
    "input": "YAMADA",
    "expected_readings": ["やまだ"],
    "expected_romaji": ["YAMADA"],
    "message": null
  },
  "mei_check": {
    "status": "OK",
    "input": "TARO",
    "expected_readings": ["たろう"],
    "expected_romaji": ["TARO", "TAROU"],
    "message": null
  },
  "warnings": []
}
```

### ステータス値

| status | 意味 |
|--------|------|
| `OK` | 入力ローマ字が期待値のいずれかと一致 |
| `MISMATCH` | 入力ローマ字が期待値と不一致 |
| `UNKNOWN_READING` | 漢字の読みが辞書にない（警告のみ、通過） |

## ディレクトリ構成

```
toeic-name-validator/
├── CLAUDE.md                 # このファイル（実装計画）
├── lambda_function.py        # Lambdaハンドラ（エントリーポイント）
├── validators/
│   ├── __init__.py
│   ├── hepburn_converter.py  # ひらがな→ヘボン式ローマ字変換
│   ├── kanji_reader.py       # 漢字→読み変換
│   └── name_matcher.py       # 整合性チェックロジック
├── data/
│   └── name_readings.json    # 人名用漢字読み辞書
├── tests/
│   └── test_validator.py     # テストコード
└── requirements.txt          # 依存ライブラリ（なし or 標準ライブラリのみ）
```

## 実装詳細

### 1. hepburn_converter.py - ヘボン式ローマ字変換

**機能**
- ひらがな/カタカナ → ヘボン式ローマ字変換
- 外務省パスポート表記に準拠

**ヘボン式の主要ルール**
| ひらがな | ローマ字 | 備考 |
|----------|----------|------|
| し | SHI | |
| ち | CHI | |
| つ | TSU | |
| ふ | FU | |
| じ/ぢ | JI | |
| しゃ/しゅ/しょ | SHA/SHU/SHO | |
| ちゃ/ちゅ/ちょ | CHA/CHU/CHO | |
| じゃ/じゅ/じょ | JA/JU/JO | |

**特殊ルール**
| ルール | 例 | 変換 |
|--------|-----|------|
| 撥音（ん）+ B/M/P | なんば | NAMBA |
| 促音（っ）| いっぱい | IPPAI |
| 長音（おお/おう）| 大野 | ONO または OHNO |

**長音表記の揺れ対応**
- `おお` → `O` または `OH`（両方を候補として生成）
- `おう` → `O` または `OU`（両方を候補として生成）
- `ゆう` → `YU` または `YUU`

### 2. kanji_reader.py - 漢字→読み変換

**機能**
- 漢字文字列から想定される読み（ひらがな）を取得
- 複数の読み候補を返す

**実装方式**
- 内蔵辞書ベース（外部ライブラリ不使用）
- 人名でよく使われる漢字と読みのマッピング
- 姓・名それぞれに特化した読み辞書

**辞書データ例**
```json
{
  "山田": ["やまだ"],
  "田中": ["たなか"],
  "佐藤": ["さとう"],
  "鈴木": ["すずき"],
  "高橋": ["たかはし"],
  "渡辺": ["わたなべ", "わたべ"],
  "河野": ["こうの", "かわの"],
  "太郎": ["たろう"],
  "花子": ["はなこ"]
}
```

**辞書にない場合の処理**
1. 単漢字に分解して読みを推定
2. 推定できない場合は `UNKNOWN_READING` ステータスを返す
3. バリデーションは通過させる（警告のみ）

### 3. name_matcher.py - 整合性チェック

**処理フロー**
```
1. 漢字氏名 → kanji_reader → 読み候補リスト
2. 読み候補 → hepburn_converter → ローマ字候補リスト
3. 入力ローマ字と候補リストを比較
4. いずれかと一致すればOK
```

**比較ルール**
- 大文字に正規化して比較
- 長音表記の揺れ（O/OH/OU）は全て許容
- スペースは除去して比較

### 4. lambda_function.py - Lambdaハンドラ

**エントリーポイント**
```python
def lambda_handler(event, context):
    # 入力バリデーション
    # 整合性チェック実行
    # 結果を返却
```

**エラーハンドリング**
- 必須パラメータ不足 → 400エラー
- 内部エラー → 500エラー

## テストケース

### 正常系

| 漢字姓 | 漢字名 | ローマ字姓 | ローマ字名 | 期待結果 |
|--------|--------|------------|------------|----------|
| 山田 | 太郎 | YAMADA | TARO | OK |
| 佐藤 | 花子 | SATO | HANAKO | OK |
| 大野 | 一郎 | ONO | ICHIRO | OK |
| 大野 | 一郎 | OHNO | ICHIRO | OK（OH表記許容）|
| 河野 | 次郎 | KONO | JIRO | OK |
| 河野 | 次郎 | KAWANO | JIRO | OK（複数読み許容）|

### 異常系

| 漢字姓 | 漢字名 | ローマ字姓 | ローマ字名 | 期待結果 |
|--------|--------|------------|------------|----------|
| 山田 | 太郎 | TANAKA | TARO | MISMATCH（姓不一致）|
| 佐藤 | 花子 | SATO | TARAKO | MISMATCH（名不一致）|

### 警告系

| 漢字姓 | 漢字名 | ローマ字姓 | ローマ字名 | 期待結果 |
|--------|--------|------------|------------|----------|
| 珍名 | 奇名 | CHINMEI | KIMEI | UNKNOWN_READING + 通過 |

## デプロイ

### Lambda設定

- ランタイム: Python 3.11+
- メモリ: 128MB（十分）
- タイムアウト: 3秒
- 外部依存: なし（標準ライブラリのみ）

### パッケージング

```bash
cd toeic-name-validator
zip -r function.zip lambda_function.py validators/ data/
```

## 制約・注意事項

1. **読み辞書の限界**: 全ての人名をカバーすることは不可能。辞書にない名前は警告付きで通過させる
2. **当て字・キラキラネーム**: 漢字の一般的な読みと異なる場合は検出できない
3. **外国籍の方**: 漢字表記がない場合はこのバリデーターの対象外

## 拡張案（将来）

- [ ] 読み辞書の拡充（人名辞典データの取り込み）
- [ ] ひらがな入力オプション（読みを直接入力）
- [ ] 訓令式ローマ字のサポート
- [ ] バッチ処理対応
